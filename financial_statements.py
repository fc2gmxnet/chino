
## Financial statements
# Balance sheet
# Income statement (P&L)
# Cash flow statement
# DuPont framework

import streamlit as st
import pandas as pd
import random

# --- Data setup ---
df_dictionary = {'Lesson': ['11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '11_Balance sheet_Foundations', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '12_Balance sheet_Assets', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '13_Balance sheet_Liabilities and equity', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '14_Balance sheet_Liquidity and solvency ratios', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '15_Balance sheet_Efficiency and quality insights', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '16_Balance sheet_Advanced analysis and red flags', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '21_Income statement_Foundations and revenue', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '22_Income statement_COGS and gross profit', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '23_Income statement_Operating expenses and EBITDA', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '24_Income statement_Below the line_interests and taxes', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '25_Income statement_The bottom line and EPS', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '26_Income statement_Analysis quality and red flags', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '31_Cash flow statement_Foundations', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '32_Cash flow statement_Operating activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '33_Cash flow statement_Investing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '34_Cash flow statement_Financing activities', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '35_Cash flow statement_Free cash flow', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '36_Cash flow statement_Analysis and red flags', '41_DuPont analysis', '41_DuPont analysis', '41_DuPont analysis', '41_DuPont analysis', '41_DuPont analysis', '41_DuPont analysis', '41_DuPont analysis'], 'Question': ['What is the fundamental accounting equation?', 'Why is it called a "Balance" sheet?', 'Is the balance sheet a flow or a static report?', 'What does "liquidity" refer to on the asset side?', 'In what order are assets usually listed?', 'What is "Book Value"?', 'Why might Book Value differ from Market Value?', 'What are "Current Assets"?', 'What are "Current Liabilities"?', 'What is Working Capital?', 'What constitutes "Cash & Cash Equivalents"?', 'What is "Accounts Receivable" (AR)?', 'What is the "Allowance for Doubtful Accounts"?', 'How is Inventory valued?', 'What is the difference between FIFO and LIFO?', 'What is PPE?', 'What is "Accumulated Depreciation"?', 'What are Intangible Assets?', 'How does "Goodwill" appear on a balance sheet?', 'When is Goodwill "impaired"?', 'What is a "Prepaid Expense"?', 'Why is "Restricted Cash" listed separately?', 'What are "Accounts Payable"?', 'What are "Accrued Liabilities"?', 'What is "Deferred Revenue"?', 'What is the difference between Short-term and Long-term debt?', 'What does "Current Portion of Long-Term Debt" mean?', 'What are "Deferred Tax Liabilities"?', 'What is "Common Stock" at Par Value?', 'What is "Additional Paid-In Capital" (APIC)?', 'What are "Retained Earnings"?', 'What is "Treasury Stock"?', 'What is "Accumulated Other Comprehensive Income" (AOCI)?', 'Why is Equity often called "Net Assets"?', 'What does the Current Ratio measure?', 'Why is the "Quick Ratio" more conservative?', 'Formula for the Quick Ratio?', 'What is the Debt-to-Equity (D/E) Ratio?', 'What is "Net Debt"?', 'Why do analysts use "Debt to EBITDA" instead of just Debt?', 'What is the "Equity Multiplier"?', 'What does a very high Current Ratio suggest?', 'What does a Current Ratio below 1.0 imply?', 'What is "Solvency"?', 'What is Inventory Turnover?', 'What are "Days Sales Outstanding" (DSO)?', 'What does a rising DSO indicate?', 'What is Asset Turnover?', 'What is the "Cash Conversion Cycle"?', 'Formula for CCC?', 'Why do analysts prefer a negative CCC?', 'What is a "Write-down"?', 'What is "Off-Balance Sheet" financing?', 'What is "Window Dressing"?', 'How can a company hide debt?', 'Why check "Notes to the Financial Statements"?', 'What is a "Contingent Liability"?', 'What does a sudden spike in "Other Assets" mean?', 'If Cash is increasing but Net Income is flat, why?', 'What is the "Ultimate" goal of BS analysis?', 'What should a BS analysis answer?', 'What is the primary purpose of the Income Statement?', 'What is the "Top Line"?', 'What is the difference between "Gross Revenue" and "Net Revenue"?', 'When is revenue "recognized" under accrual accounting?', 'What is "Deferred Revenue"?', 'What does "Organic Growth" mean?', 'Why is "Revenue Concentration" a risk?', 'What is "Recurring Revenue"?', 'What is a "Top-Down" revenue analysis?', 'What is a "Bottom-Up" revenue analysis?', 'What is COGS?', 'What is Gross Profit?', 'How do you calculate Gross Margin?', 'What does a declining Gross Margin suggest?', 'Are administrative salaries included in COGS?', 'How does Depreciation affect COGS?', 'What is "Operating Leverage"?', 'Why is Gross Profit the "first line of defense"?', 'What is "Service Revenue" COGS?', 'Can COGS include shipping costs?', 'What does SG&A stand for?', 'What is R&D expense?', 'Is R&D an investment or an expense?', 'What is EBITDA?', 'Why do analysts love EBITDA?', 'What is the main criticism of EBITDA?', 'What is Operating Income (EBIT)?', 'What is "Stock-Based Compensation"?', 'What is an "Impairment Charge"?', 'What is "Amortization"?', 'How does "Marketing Spend" relate to Revenue?', 'What is a "Restructuring Charge"?', 'What is "Interest Expense"?', 'What is "Interest Income"?', 'What is the "Interest Coverage Ratio"?', 'What is "Pre-Tax Income" (EBT)?', 'What is the "Effective Tax Rate"?', 'Why might the Effective Tax Rate differ from the Statutory Rate?', 'What are "Non-Operating Items"?', 'What is "Equity in Earnings of Affiliates"?', 'What is Net Income?', 'What is the Net Profit Margin?', 'What is EPS (Earnings Per Share)?', 'What is "Basic EPS"?', 'What is "Diluted EPS"?', 'Why is Diluted EPS more important for analysts?', 'How do share buybacks affect EPS?', 'What is "Net Income Attributable to the Parent"?', 'What is "Vertical Analysis"?', 'What is "Horizontal Analysis"?', 'What is "Quality of Earnings"?', 'What is "Channel Stuffing"?', 'What does "Big Bath" accounting mean?', 'Why is "Other Comprehensive Income" (OCI) not on the P&L?', 'What is the "Accruals Ratio"?', 'How does a "Non-Recurring Gain" distort analysis?', 'What is "Contribution Margin"?', 'What is "EBITDA Margin"?', 'If Revenue is up 10% but Net Income is down 5%, what happened?', 'What is the "Rule of 40"?', 'What is the time scope of a balance sheet and income statement?', 'What is the primary purpose of the Cash Flow Statement?', 'What are the three main sections of the CFS?', 'Why is the CFS necessary if we have an Income Statement?', 'What is the "Cash Flow Identity"?', 'What is the difference between the Direct and Indirect method?', 'Which method is most commonly used by public companies?', 'Does a "Net Loss" on the Income Statement always mean negative Cash Flow?', 'What is "Cash and Cash Equivalents" (CCE)?', 'Why is the CFS harder to "manipulate" than the P&L?', 'Where does "Interest Paid" usually sit under US GAAP?', 'What is the difference of cash flow vs. income statements?', 'What is CFO?', 'Why do we "add back" Depreciation to Net Income?', 'How does an increase in Accounts Receivable (AR) affect CFO?', 'How does a decrease in Inventory affect CFO?', 'How does an increase in Accounts Payable (AP) affect CFO?', 'What are "Non-Cash Charges"?', 'What is "Deferred Tax" in the context of CFO?', 'Why is a gain on the sale of an asset subtracted from CFO?', 'What does a consistently negative CFO indicate?', 'How does "Stock-Based Compensation" affect CFO?', 'What is CFI?', 'What is "CapEx"?', 'Why is CapEx usually a negative number?', 'Where would the purchase of another company (M&A) appear?', 'What is the difference between "Maintenance CapEx" and "Growth CapEx"?', 'If a company sells a factory, where does the cash go?', 'How are "Marketable Securities" handled in CFI?', 'Is a positive CFI usually a good sign?', 'What is CFF?', 'Is "Issuing Debt" a positive or negative CFF?', 'Is "Paying Dividends" a positive or negative CFF?', 'Where do "Share Buybacks" appear?', 'If a company repays the principal of a loan, where is it recorded?', 'Why is "Interest Paid" in Operating but "Dividends Paid" in Financing?', 'What does a high positive CFF often suggest?', 'What is the basic formula for Free Cash Flow?', 'Why do analysts prioritize FCF over Net Income?', 'What is "FCF Yield"?', 'What is "Unlevered Free Cash Flow" (UFCF)?', 'What is "Levered Free Cash Flow"?', 'Can a company have a high Net Income but negative FCF?', 'What is a "Cash Burn" rate?', 'What is the "Cash Flow Coverage Ratio"?', 'What is the "Dividend Coverage Ratio" (Cash Basis)?', 'Red Flag: CFO is consistently lower than Net Income.', 'Red Flag: Negative CFO but positive CFF.', 'Red Flag: Selling assets to pay dividends.', 'What is "Window Dressing" in cash flow?', 'How do you calculate the "Cash Conversion Ratio"?', 'Why check the "Notes" for operating leases?', 'What is "Reinvestment Risk"?', 'If a company has a "One-time" legal settlement, where does it go?', 'What is "Working Capital Intensity"?', 'How does a "Hyper-growth" company often look on a CFS?', 'What is the "Operating Cash Flow Margin"?', 'Why do rating analysts look at "Liquidity Runway"?', 'What is "Cash Flow Volatility"?', 'What is "Owner Earnings"?', 'How do you detect "aggressive" revenue recognition via the CFS?', 'Final Analysis Rule: Where should cash ultimately come from?', 'How does DuPont analysis work?', 'What is its key strategic insight', 'What is ROE?', 'ROE Formula in 3 elements?', 'ROE Formula in 3 elements, extended', 'ROE Formula in 5 elements?', 'ROE Formula in 5 elements, extended'], 'Answer': ['Assets=Liabilities+Shareholders′Equity', 'Because the total value of assets must always equal the sum of liabilities and equity.', 'It is a static snapshot at a specific point in time (e.g., Dec 31).', 'How quickly an asset can be converted into cash without significant loss in value.', 'In order of liquidity (Current Assets first, then Non-Current).', 'The value of an asset as recorded on the balance sheet, usually cost minus accumulated depreciation.', 'Balance sheets use historical cost; market value reflects future earning potential and current demand.', 'Assets expected to be converted to cash or used up within one year.', 'Obligations due to be settled within one year.', 'CurrentAssets−CurrentLiabilities. It measures short-term operating liquidity.', 'Physical currency, bank deposits, and highly liquid investments with maturities of 3 months or less.', 'Money owed to the company by customers for goods/services delivered on credit.', "A contra-asset account estimating the portion of AR that won't be collected.", 'Usually at the "Lower of Cost or Net Realizable Value."', 'FIFO assumes first items in are first out; LIFO assumes last items in are first out (affects COGS and taxes).', 'Property, Plant, and Equipment—tangible long-term assets used in operations.', "The total amount of an asset's cost that has been allocated as an expense since it was acquired.", 'Non-physical assets like patents, trademarks, and copyrights.', 'It arises when one company acquires another for more than the fair market value of its net identifiable assets.', 'When its carrying value exceeds its fair value, requiring a write-down (a red flag for analysts).', 'An asset representing payments made for services to be received in the future (e.g., insurance).', 'Because it cannot be used for general operations (often tied to debt covenants).', 'Money the company owes to suppliers for purchases made on credit.', 'Expenses incurred but not yet paid or invoiced (e.g., wages, taxes).', 'A liability representing cash received in advance of providing a service or product.', 'Maturity: Short-term is due within 12 months; Long-term is due beyond that.', 'The slice of long-term debt that must be paid within the next year.', 'Taxes that are owed but not yet paid due to timing differences between accounting and tax laws.', 'The nominal value assigned to shares (usually very low, like $0.01).', 'The excess amount paid by investors over the par value of the shares.', 'Cumulative net income that has been kept in the business rather than paid out as dividends.', 'Shares that the company has bought back from the open market (reduces total equity).', 'Items like unrealized gains/losses on investments or foreign currency translations.', 'Because Equity=Assets−Liabilities; it’s what’s left for owners.', 'Ability to pay short-term debts (CurrentAssets/CurrentLiabilities).', 'It excludes Inventory from current assets, as inventory can be hard to sell quickly.', '(Cash+MarketableSecurities+Receivables)/CurrentLiabilities.', 'Total Liabilities / Total Equity; it measures financial leverage.', 'TotalDebt−(Cash+CashEquivalents).', 'To see how many years of operating cash flow it would take to pay back the debt.', 'TotalAssets/TotalEquity; a component of the DuPont analysis.', 'Potential inefficiency; the company might be sitting on too much idle cash or inventory.', 'Potential liquidity distress (the "Current Gap").', 'The long-term ability of a company to meet its total financial obligations.', 'How many times a company sells and replaces its inventory in a period (COGS/AverageInventory).', 'The average number of days it takes to collect payment after a sale.', 'Potential credit issues with customers or aggressive revenue recognition.', 'Revenue/AverageTotalAssets; measures how efficiently assets generate sales.', 'The time (in days) it takes to turn resource inputs into cash flows.', 'DaysInventoryOutstanding+DaysSalesOutstanding−DaysPayableOutstanding.', 'It means the company is effectively being financed by its suppliers (like Amazon).', 'Reducing the book value of an asset because its market value has fallen.', 'Obligations not recorded on the BS (e.g., historical operating leases, though rules have tightened).', 'Manipulating the BS at year-end to make the financial position look better than it is.', 'Through Special Purpose Entities (SPEs) or classifying debt as "other liabilities."', 'To find details on debt covenants, contingent liabilities, and accounting assumptions.', 'A potential debt that depends on a future event (e.g., a pending lawsuit).', 'Usually a dumping ground for costs that should have been expensed; needs investigation.', 'Could be from issuing debt or selling assets, not necessarily healthy operations.', "To determine the company's risk profile and its ability to generate future returns.", 'Where did the money come from (Liabilities/Equity), and where did it go (Assets)?', "To show a company's financial performance (profit or loss) over a specific reporting period.", 'Revenue (or Net Sales); the total amount of money earned before any expenses are deducted.', 'Net Revenue is Gross Revenue minus returns, allowances, and discounts.', 'When it is earned (goods delivered or services performed), regardless of when cash is received.', 'Money received for work not yet performed; it sits on the Balance Sheet as a liability, not on the Income Statement.', 'Revenue growth generated from existing operations, excluding acquisitions or currency fluctuations.', 'If a high percentage of revenue comes from a single customer, the company is vulnerable if that customer leaves.', 'Revenue that is predictable and likely to continue (e.g., monthly subscriptions).', "Starting with total market size and estimating the company's market share percentage.", 'Calculating revenue by multiplying the number of units sold by the average selling price (Price x Volume).', 'The direct costs attributable to the production of the goods or services sold (materials, direct labor).', 'GrossProfit=Revenue−COGS.', '(GrossProfit/Revenue)×100.', 'Rising input costs, pricing pressure from competitors, or a shift to lower-margin products.', 'No, those are operating expenses (SG&A), not direct production costs.', 'For manufacturers, depreciation of factory machinery is often included in COGS.', 'The degree to which a company uses fixed costs; high fixed costs mean profits grow faster as revenue increases.', 'It shows if a company’s core product is fundamentally profitable before overhead is considered.', 'Usually includes the labor costs of the consultants or technicians providing the service.', 'Yes, if those costs are required to get the product ready for sale (inbound freight).', 'Selling, General, and Administrative expenses (the "overhead").', 'Research and Development; costs associated with innovating and developing new products.', 'In the US (GAAP), it is usually expensed immediately, though it builds future value.', 'Earnings Before Interest, Taxes, Depreciation, and Amortization.', 'It’s a proxy for operating cash flow and allows for better comparison between companies with different capital structures.', 'It ignores the real costs of replacing aging equipment (Depreciation) and interest on debt.', 'GrossProfit−OperatingExpenses. It shows profit from core operations.', 'A non-cash expense where employees are paid in shares; it must be added back to find "Adjusted EBITDA."', 'A non-cash expense recorded when the value of an asset (like Goodwill) drops permanently.', 'The systematic expensing of the cost of an intangible asset over its useful life.', 'Analysts look at the "LTV to CAC" ratio (Life Time Value to Customer Acquisition Cost).', 'One-time costs for layoffs or closing facilities; analysts often treat these as "non-recurring."', 'The cost of borrowing money on debt; it is tax-deductible.', "Money earned from the company's cash balances or investments.", 'EBIT/InterestExpense. It measures the ability to pay interest on debt.', 'Operating Income minus Interest and other non-operating items.', 'IncomeTaxExpense/Pre−TaxIncome.', 'Due to tax credits, overseas earnings in lower-tax jurisdictions, or tax law loopholes.', 'Gains or losses from activities not related to core business (e.g., selling a piece of land).', "The company's share of profits from a company it owns a minority stake in.", 'The "Bottom Line"; total earnings after all expenses, interest, and taxes are paid.', 'NetIncome/TotalRevenue.', 'NetIncome/WeightedAverageSharesOutstanding.', 'EPS calculated using only shares currently issued and outstanding.', 'EPS that includes potential shares from stock options, warrants, and convertible debt.', 'It shows the "worst-case" scenario of ownership being spread across more people.', 'They reduce the number of shares, which increases EPS even if Net Income stays the same.', 'Net Income minus the portion belonging to "Non-controlling interests" (minority owners).', 'Expressing every line item as a percentage of Revenue (Common Size Income Statement).', 'Comparing line items across multiple years to identify trends (Year-over-Year growth).', 'How well Net Income reflects actual cash flow. High quality = high cash conversion.', 'A red flag where a company sends extra inventory to distributors to inflate sales figures.', 'Taking all possible losses/write-offs in one bad year to make future years look "cleaner."', 'It includes unrealized items (like currency shifts) that haven\'t "passed through" the income statement yet.', 'A measure to detect if profits are being driven by accounting tricks rather than cash.', 'It creates a "one-time" spike in profit that won\'t happen next year; analysts usually "strip it out."', 'Sales−VariableCosts. It helps determine the break-point for a specific product.', 'EBITDA/Revenue. It’s the standard for comparing profitability in the private equity world.', '"Margin Compression"—expenses grew faster than sales.', 'For software companies: GrowthRate+ProfitMargin should be 40% or higher.', 'Balance sheet: snapshot. Income statement: a movie over a period of time', 'To show the actual cash inflows and outflows of a business over a period, stripping away non-cash accounting entries.', '1. Operating Activities, 2. Investing Activities, 3. Financing Activities.', 'Because Net Income includes non-cash items (like depreciation) and ignores cash moves like buying equipment or repaying debt.', 'NetChangeinCash=CFO+CFI+CFF.', 'The Indirect method starts with Net Income and adjusts for non-cash items; the Direct method lists actual cash receipts and payments.', 'The Indirect Method, as it reconciles the Income Statement to the Balance Sheet.', 'No. High non-cash expenses (like depreciation) can result in positive cash flow despite an accounting loss.', 'The starting and ending point of the CFS; includes physical cash and highly liquid investments (maturities < 3 months).', 'Because it tracks the movement of actual bank balances, which are harder to fudge than subjective accrual estimates.', 'Operating Activities (though some argue it should be Financing).', 'Cash flow statement is the lie detector: profit is an opinion, cash is a fact', "Cash generated from the company's core business products or services. The engine of the company", "Because it is a non-cash expense that reduced Net Income but didn't actually involve cash leaving the bank.", 'It is a subtraction; it represents revenue recognized but not yet collected in cash.', 'It is an addition; it means the company sold more product than it bought/produced, releasing cash.', 'It is an addition; the company is keeping its cash longer by delaying payments to suppliers.', 'Expenses like Depreciation, Amortization, and Stock-Based Compensation.', 'Adjustments for the difference between taxes owed (P&L) and taxes actually paid in cash.', 'To avoid double-counting; the full cash receipt is recorded in the Investing section.', 'A company that cannot sustain its operations without external funding—a major red flag.', 'It is added back to Net Income because it’s a non-cash expense (employees are paid in shares, not cash).', 'Cash used for or generated from long-term assets (buying equipment, selling buildings, M&A). Building the future', 'Capital Expenditures; the cash spent to acquire or upgrade physical assets (PPE).', "Because it represents a cash outflow to invest in the business's future.", 'In the Investing Activities section.', 'Maintenance keeps current operations running; Growth expands the business (analysts often have to estimate this).', 'As a positive inflow in the Investing Activities section.', 'Buying stocks/bonds of other companies is an outflow; selling them is an inflow.', 'Not necessarily; it could mean the company is "liquidating" (selling off) its future to stay afloat today.', 'Cash flow between the company and its owners (equity) or creditors (debt). Funding of the company', 'Positive; the company is receiving cash from lenders.', 'Negative; cash is leaving the company to go to shareholders.', 'As a negative outflow in the Financing Activities section.', 'Financing Activities (Outflow).', 'It’s an accounting convention (GAAP); interest is an operating cost of capital, dividends are a distribution of profit.', 'The company is aggressively raising capital through debt or equity to fund growth or cover losses.', 'FCF=CFO−CapEx. The golden metric', 'Because FCF represents the "disposable" cash a company can use to pay dividends, buy back shares, or pay down debt.', 'FCF/MarketCapitalization. It helps compare the cash generation of different sized companies.', 'Cash flow available to all capital providers (Debt + Equity) before interest payments.', 'Cash flow available to shareholders after interest and debt obligations are met.', 'Yes, if it has massive CapEx requirements or if its cash is tied up in unpaid invoices (AR).', 'The speed at which a company (usually a startup) uses up its cash reserves in CFO and CFI.', 'CFO/TotalDebt. Measures how quickly a company could pay off debt using only operations.', 'FCF/DividendsPaid. If < 1.0, the company is borrowing money to pay its dividend (unsustainable).', 'Indicates "poor quality of earnings"—profits are coming from accounting entries, not cash.', 'The company is "living on a credit card"—paying for daily operations by taking on more debt.', 'Shown by positive CFI (asset sales) paired with negative CFF (dividends).', 'Delaying payments to suppliers (increasing AP) right before the quarter ends to boost CFO.', 'CFO/EBITDA. High ratios (e.g., >80%) indicate a very efficient, "cash-cowing" business.', 'To see future cash obligations that might not be fully reflected in the CFF yet.', 'When a company has high FCF but no profitable projects to invest in, leading to potentially poor M&A decisions.', "Usually Operating Activities, even if it's unusual.", 'The amount of cash a company must "trap" in operations to grow revenue.', 'High Revenue (P&L), Negative CFO (due to scaling inventory/AR), and High Positive CFF (fundraising).', 'CFO/Revenue. Shows how much cash is generated per dollar of sales.', 'To see how many months/years a company can survive if its access to capital markets is cut off.', 'How much CFO swings year-to-year; high volatility usually leads to a lower credit rating.', 'A Warren Buffett term: NetIncome+Depreciation/Amortization−MaintenanceCapEx.', 'Look for AR growing significantly faster than Revenue (DSO increasing).', 'In a healthy, mature company, cash should come from Operations, not Financing or Asset Sales.', 'Analysis of return on equity according sales profitability, assets efficiency and financial leverage', 'It highlights trade-offs—e.g., a company may rely heavily on debt (high equity multiplier) rather than strong operations', 'ROE: Return on Equity = Net Income / Shareholders equity', 'ROE: Net profit margin · Asset turnover · Equity multiplier', 'ROE: (Net income / Sales) · (Sales / Total assets) · (Total assets / Shareholders equity)', 'ROE: Tax burden · Interest burden · Operating margin · Asset turnover · Equity multiplier', 'ROE: (Net income / Earnings before tax) · (EBT / EBIT) · (EBIT / Sales) · (Sales / Total assets) · (Total assets / Shareholders equity)'], 'Image': ['https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/balance_sheet.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/income_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/cash_flow_statement.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png', 'https://github.com/fc2gmxnet/chino/raw/main/imagenes/finances/dupont_formula.png']}
df = pd.DataFrame(df_dictionary)
df['Lesson'] = df['Lesson'].astype(str)  # Ensure lessons are strings

# --- Page configuration ---
st.set_page_config(
    page_title='maps - Pesquisa Google',
    page_icon='https://github.com/fc2gmxnet/chino/raw/main/icons8-google-logo-48.png',
    layout='wide'
)

# --- UI: Dropdown on top, Toggle below ---
selected_lesson = st.selectbox("Select Chapter", sorted(df['Lesson'].unique()))
toggle = st.toggle("Random question order")


# --- question answer columns ---
#if toggle:
 #   columna_pregunta = 2
 #   columna_respuesta = 1
#else:
#    columna_pregunta = 1
#    columna_respuesta = 2
# END --- UI: Dropdown on top, Toggle below ---


# --- Without using UI: Dropdown
columna_pregunta = 1
columna_respuesta = 2
columna_imagen = 3
# END--- Without using UI: Dropdown


# --- Filter by selected lesson ---
filtered_df = df[df['Lesson'] == selected_lesson]

# --- Session state for random index ---
if "index" not in st.session_state or st.session_state.get("last_lesson") != selected_lesson:
    st.session_state.index = 0 if not toggle else random.randint(0, len(filtered_df) - 1)
    st.session_state.last_lesson = selected_lesson
    st.session_state.show_answer = False


# --- Function to pick a new random row ---
def get_new_random_row():
    if not filtered_df.empty:
        st.session_state.index = random.randint(0, len(filtered_df) - 1)

def get_next_ordered_row():
    if not filtered_df.empty:
        st.session_state.index = (st.session_state.index + 1) % len(filtered_df)

# --- Add CSS to style the buttons
st.markdown(
    """
    <style>
    div.stButton > button:first-child {
        width: 350px;
        #height: 50px;
        #font-size: 20px;
    }
    </style>
    """,
    unsafe_allow_html=True
)

# Initialize state for revealing the answer (NEW)
if 'show_answer' not in st.session_state:
    st.session_state.show_answer = False

# --- Display question ---
if not filtered_df.empty:
    current_row = filtered_df.iloc[st.session_state.index]
    st.subheader(current_row.iloc[columna_pregunta])

    # Reveal answer
    if st.button('?'):
        st.session_state.show_answer = not st.session_state.show_answer

    # Logic to show answer based on state
    if st.session_state.show_answer:
        st.subheader(current_row.iloc[columna_respuesta])

    # Next question
    if st.button('►'):
        st.session_state.show_answer = False # Reset for next question
        if toggle:
            get_new_random_row()
        else:
            get_next_ordered_row()
        st.rerun()

else:
    st.warning("No questions available for this lesson.")

# --- JavaScript for keyboard shortcuts ---
# Using .includes() and filtering by button tag is more reliable
shortcut = """
<script>
    const doc = window.parent.document;
    doc.addEventListener('keydown', function(e) {
        // Prevent spacebar from scrolling the page
        if (e.code === 'Space') e.preventDefault();

        const btns = Array.from(doc.querySelectorAll('button'));
        
        // Target Reveal button
        if (['ArrowLeft', 'ArrowDown', 'Space', 'a'].includes(e.key) || e.code === 'Space') {
            const revealBtn = btns.find(el => el.innerText.includes('?'));
            if (revealBtn) revealBtn.click();
        }
        
        // Target Next button
        if (['ArrowRight', 'q'].includes(e.key)) {
            const nextBtn = btns.find(el => el.innerText.includes('►'));
            if (nextBtn) nextBtn.click();
        }
    }, {once: false}); 
</script>
"""

# Use components.html for cleaner JS execution or stick to markdown
st.components.v1.html(shortcut, height=0)

# 7. Image below buttons
if columna_imagen in current_row.index and not pd.isna(current_row[columna_imagen]):
    st.image(
        current_row[columna_imagen],
        caption="view",
        use_column_width=True
     )
